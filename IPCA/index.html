<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reposit√≥rio Mec√¢nica Autom√≥vel | IPCA</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>
    <canvas id="hero-canvas"></canvas>
    <div class="layout">
        <!-- Left Column - Hero/Branding -->
        <aside class="hero-column">

            <div class="hero-content">
                <div class="logo-container">
                    <img src="img/logo_ipca.png" alt="IPCA Logo" class="ipca-logo">
                </div>
                <h1>Mec√¢nica Autom√≥vel</h1>
                <p class="hero-desc">
                    Reposit√≥rio de trabalhos acad√©micos e apresenta√ß√µes desenvolvidos
                    no √¢mbito do curso de Mec√¢nica Autom√≥vel do IPCA.
                </p>
            </div>
        </aside>

        <!-- Right Column - Content -->
        <main class="content-column">
            <div class="content-scroll">
                <h2 class="section-title">Disciplinas & Trabalhos</h2>

                <!-- Motores de Combust√£o Interna -->
                <section class="course-card">
                    <div class="course-header">
                        <h3 class="course-title">Motores de Combust√£o Interna</h3>
                        <span class="professor-tag">Prof. Pedro Correia</span>
                    </div>
                    <div class="projects">
                        <div class="project-item">
                            <a href="./MotoresDeCombustao/arrefecimento/index.html" class="project-link">
                                <span class="project-icon">üå°Ô∏è</span>
                                <div class="project-info">
                                    <span class="project-name">Sistema de Arrefecimento</span>
                                    <span class="project-desc">M√©todos de teste e diagn√≥stico</span>
                                </div>
                                <span class="arrow">‚Üí</span>
                            </a>
                            <div class="project-actions">
                                <button class="action-btn" onclick="openGroupModal()" title="Ver Grupo">
                                    <span>üë•</span>
                                </button>
                                <button class="action-btn"
                                    onclick="openPdfInfo('./MotoresDeCombustao/arrefecimento/index.html')"
                                    title="Vers√£o PDF">
                                    <span>üìÑ</span>
                                </button>
                                <button class="action-btn notes-btn hidden"
                                    onclick="openNotesViewer('./MotoresDeCombustao/arrefecimento/index.html', 'Sistema de Arrefecimento')"
                                    title="Ver Notas (prima 's' para mostrar)">
                                    <span>üìù</span>
                                </button>
                            </div>
                        </div>
                        <div class="project-item">
                            <a href="./MotoresDeCombustao/hibridos/index.html" class="project-link">
                                <span class="project-icon">‚ö°</span>
                                <div class="project-info">
                                    <span class="project-name">MCI em Ve√≠culos H√≠bridos</span>
                                    <span class="project-desc">Motor de combust√£o em arquiteturas h√≠bridas</span>
                                </div>
                                <span class="arrow">‚Üí</span>
                            </a>
                            <div class="project-actions">
                                <button class="action-btn" onclick="openGroupModal()" title="Ver Grupo">
                                    <span>üë•</span>
                                </button>
                                <button class="action-btn"
                                    onclick="openPdfInfo('./MotoresDeCombustao/hibridos/index.html')"
                                    title="Vers√£o PDF">
                                    <span>üìÑ</span>
                                </button>
                                <button class="action-btn notes-btn hidden"
                                    onclick="openNotesViewer('./MotoresDeCombustao/hibridos/index.html', 'MCI em Ve√≠culos H√≠bridos')"
                                    title="Ver Notas (prima 's' para mostrar)">
                                    <span>üìù</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TDEM - Avarias -->
                <section class="course-card">
                    <div class="course-header">
                        <h3 class="course-title">T√©cnicas de Diagn√≥stico e Ensaio e Multiplexagem</h3>
                        <span class="professor-tag">Prof. Lu√≠s Lopes</span>
                    </div>
                    <div class="projects">
                        <div class="project-item">
                            <a href="./TDEM_Avarias/EGR_DPF/index.html" class="project-link">
                                <span class="project-icon">üí®</span>
                                <div class="project-info">
                                    <span class="project-name">Avarias - EGR e DPF</span>
                                    <span class="project-desc">Recircula√ß√£o de gases e filtro de part√≠culas</span>
                                </div>
                                <span class="arrow">‚Üí</span>
                            </a>
                            <div class="project-actions">
                                <button class="action-btn" onclick="openGroupModal()" title="Ver Grupo">
                                    <span>üë•</span>
                                </button>
                                <button class="action-btn" onclick="openPdfInfo('./TDEM_Avarias/EGR_DPF/index.html')"
                                    title="Vers√£o PDF">
                                    <span>üìÑ</span>
                                </button>
                                <button class="action-btn notes-btn hidden"
                                    onclick="openNotesViewer('./TDEM_Avarias/EGR_DPF/index.html', 'Avarias - EGR e DPF')"
                                    title="Ver Notas (prima 's' para mostrar)">
                                    <span>üìù</span>
                                </button>
                            </div>
                        </div>
                        <div class="project-item">
                            <a href="./TDEM_Avarias/Catalisador_SondaLambda/index.html" class="project-link">
                                <span class="project-icon">‚ôªÔ∏è</span>
                                <div class="project-info">
                                    <span class="project-name">Avarias - Catalisador e Sonda Lambda</span>
                                    <span class="project-desc">Diagn√≥stico e verifica√ß√£o de componentes</span>
                                </div>
                                <span class="arrow">‚Üí</span>
                            </a>
                            <div class="project-actions">
                                <button class="action-btn" onclick="openGroupModal()" title="Ver Grupo">
                                    <span>üë•</span>
                                </button>
                                <button class="action-btn"
                                    onclick="openPdfInfo('./TDEM_Avarias/Catalisador_SondaLambda/index.html')"
                                    title="Vers√£o PDF">
                                    <span>üìÑ</span>
                                </button>
                                <button class="action-btn notes-btn hidden"
                                    onclick="openNotesViewer('./TDEM_Avarias/Catalisador_SondaLambda/index.html', 'Avarias - Catalisador e Sonda Lambda')"
                                    title="Ver Notas (prima 's' para mostrar)">
                                    <span>üìù</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <footer class="content-footer" style="position: absolute; bottom:10px; width:90%">
                    <p>&copy; 2025 // 32801 - Pedro Silva</p>
                </footer>
            </div>
        </main>
    </div>

    <!-- Modal: Group -->
    <div class="modal-overlay" id="group-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Trabalho realizado por:</h3>
                <button class="modal-close" onclick="closeModal('group-modal')">‚úï</button>
            </div>
            <ul class="team-list">
                <li><span class="student-id">29458</span> Jos√© Santos</li>
                <li><span class="student-id">32801</span> Pedro Silva</li>
                <li><span class="student-id">32805</span> Rui Rodrigues</li>
                <li><span class="student-id">32813</span> Jonathan Ramirez</li>
                <li><span class="student-id">33695</span> Francisco Gon√ßalves</li>
                <li><span class="student-id">33790</span> Jo√£o Silva</li>
            </ul>
        </div>
    </div>

    <!-- Modal: PDF Info -->
    <div class="modal-overlay" id="pdf-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÑ Exportar para PDF</h3>
                <button class="modal-close" onclick="closeModal('pdf-modal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p>Para exportar a apresenta√ß√£o em PDF:</p>
                <ol class="pdf-instructions">
                    <li>Clique no bot√£o abaixo para abrir em modo de impress√£o</li>
                    <li>Use <kbd>Ctrl</kbd> + <kbd>P</kbd> (ou <kbd>‚åò</kbd> + <kbd>P</kbd> no Mac)</li>
                    <li>Selecione "Guardar como PDF" na impressora</li>
                    <li>Configure paisagem e margens m√≠nimas</li>
                </ol>
                <a id="pdf-link" href="#" target="_blank" class="pdf-btn">
                    <span>üñ®Ô∏è</span> Abrir modo de impress√£o
                </a>
            </div>
        </div>
    </div>

    <!-- Modal: Notes Viewer -->
    <div class="modal-overlay" id="notes-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="notes-title">üìù Notas do Orador</h3>
                <button class="modal-close" onclick="closeModal('notes-modal')">‚úï</button>
            </div>
            <div class="notes-filter">
                <label>Filtrar por orador:</label>
                <select id="speaker-filter" onchange="filterNotes()">
                    <option value="all">Todos os oradores</option>
                </select>
            </div>
            <div class="notes-container" id="notes-container">
                <p class="loading">A carregar notas...</p>
            </div>
        </div>
    </div>

    <script>
        // Three.js Particle Animation
        (function () {
            const canvas = document.getElementById('hero-canvas');
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera.position.z = 30;

            const particleCount = 800;
            const positions = new Float32Array(particleCount * 3);
            const velocities = [];

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 60;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 60;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 40;
                velocities.push({
                    x: (Math.random() - 0.5) * 0.02,
                    y: (Math.random() - 0.5) * 0.02,
                    z: (Math.random() - 0.5) * 0.02
                });
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const material = new THREE.PointsMaterial({
                color: 0x667eea,
                size: 0.15,
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true
            });

            const particles = new THREE.Points(geometry, material);
            scene.add(particles);

            let mouseX = 0, mouseY = 0;
            document.addEventListener('mousemove', (e) => {
                mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
            });

            function resize() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                renderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
            }

            function animate() {
                requestAnimationFrame(animate);

                const pos = geometry.attributes.position.array;
                for (let i = 0; i < particleCount; i++) {
                    pos[i * 3] += velocities[i].x;
                    pos[i * 3 + 1] += velocities[i].y;
                    pos[i * 3 + 2] += velocities[i].z;

                    if (Math.abs(pos[i * 3]) > 30) velocities[i].x *= -1;
                    if (Math.abs(pos[i * 3 + 1]) > 30) velocities[i].y *= -1;
                    if (Math.abs(pos[i * 3 + 2]) > 20) velocities[i].z *= -1;
                }
                geometry.attributes.position.needsUpdate = true;

                particles.rotation.x += (mouseY * 0.1 - particles.rotation.x) * 0.02;
                particles.rotation.y += (mouseX * 0.1 - particles.rotation.y) * 0.02;

                renderer.render(scene, camera);
            }

            resize();
            animate();
            window.addEventListener('resize', resize);
        })();

        // Modal functions
        function openGroupModal() {
            document.getElementById('group-modal').classList.add('active');
        }

        function openPdfInfo(url) {
            const pdfUrl = url + '?print-pdf';
            document.getElementById('pdf-link').href = pdfUrl;
            document.getElementById('pdf-modal').classList.add('active');
        }

        let allNotes = [];
        let allSpeakers = new Set();

        async function openNotesViewer(url, title) {
            document.getElementById('notes-title').textContent = `üìù ${title} - Notas`;
            document.getElementById('notes-container').innerHTML = '<p class="loading">A carregar notas...</p>';
            document.getElementById('speaker-filter').innerHTML = '<option value="all">Todos os oradores</option>';
            document.getElementById('notes-modal').classList.add('active');


            try {
                const response = await fetch(url);
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const slides = doc.querySelectorAll('section');
                allNotes = [];
                allSpeakers = new Set();

                let slideIndex = 0;
                slides.forEach((section) => {
                    // Skip nested sections (vertical slides for fullscreen images)
                    if (section.parentElement.tagName === 'SECTION') return;

                    const notes = section.querySelector('aside.notes');
                    if (notes) {
                        slideIndex++;
                        const slideTitle = section.querySelector('h1, h2')?.textContent?.trim() || `Slide ${slideIndex}`;

                        // Parse speaker notes
                        const noteHtml = notes.innerHTML;
                        const speakerBlocks = noteHtml.split(/<h3>|<hr>/gi).filter(b => b.trim());

                        speakerBlocks.forEach(block => {
                            const match = block.match(/üé§\s*([^<]+)/);
                            if (match) {
                                const speaker = match[1].trim();
                                allSpeakers.add(speaker);

                                // Extract the content after the speaker name
                                const contentMatch = block.match(/<\/h3>\s*([\s\S]*)/i);
                                const content = contentMatch ? contentMatch[1].replace(/<\/?p>/gi, '').trim() : '';

                                if (content) {
                                    allNotes.push({
                                        slide: slideIndex,
                                        slideTitle,
                                        speaker,
                                        content
                                    });
                                }
                            }
                        });
                    }
                });

                // Populate speaker filter
                const filter = document.getElementById('speaker-filter');
                [...allSpeakers].sort().forEach(speaker => {
                    const option = document.createElement('option');
                    option.value = speaker;
                    option.textContent = speaker;
                    filter.appendChild(option);
                });

                filterNotes();
            } catch (error) {
                document.getElementById('notes-container').innerHTML =
                    '<p class="error">Erro ao carregar notas. Verifique se a apresenta√ß√£o existe.</p>';
            }
        }

        function filterNotes() {
            const filter = document.getElementById('speaker-filter').value;
            const container = document.getElementById('notes-container');

            const filtered = filter === 'all'
                ? allNotes
                : allNotes.filter(n => n.speaker === filter);

            if (filtered.length === 0) {
                container.innerHTML = '<p class="no-notes">Nenhuma nota encontrada.</p>';
                return;
            }

            let html = '';
            let currentSlide = null;

            filtered.forEach(note => {
                if (note.slide !== currentSlide) {
                    if (currentSlide !== null) html += '</div>';
                    currentSlide = note.slide;
                    html += `<div class="notes-slide">
                        <div class="slide-header">
                            <span class="slide-number">Slide ${note.slide}</span>
                            <span class="slide-name">${note.slideTitle}</span>
                        </div>`;
                }
                html += `<div class="note-item">
                    <span class="note-speaker">üé§ ${note.speaker}</span>
                    <p class="note-content">${note.content}</p>
                </div>`;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // Close modals with Escape or click outside
        // Toggle notes buttons with 's' key (like Reveal.js)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
            }
            if (e.key === 's' || e.key === 'S') {
                // Don't toggle if typing in an input
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

                document.querySelectorAll('.notes-btn').forEach(btn => {
                    btn.classList.toggle('hidden');
                });
            }
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        });
    </script>
</body>

</html>